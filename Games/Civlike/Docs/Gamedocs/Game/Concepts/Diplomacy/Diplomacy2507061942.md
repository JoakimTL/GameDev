# Diplomacy & Treaties — Comprehensive Concept v1.1

_“Covenants, without the sword, are but words.” — Thomas Hobbes_

---

## 1 Design Tenets

|ID|Principle|Engine Implication|
|---|---|---|
|**P‑1**|**Anarchy‑First, Order‑Optional** – a promise only matters if breaking it is costlier than keeping it.|Every clause can fail; AI evaluates cost via _Credibility_ and _Trust_.|
|**P‑2**|**Atomic, Data‑Driven Clauses** – Everything from a 10‑turn truce to a NATO‑style charter is a stack of clauses.|Clauses live in JSON; each line names an existing C# behaviour.|
|**P‑3**|**Transparent History** – All changes append to an immutable event stream.|`TreatyEvent` log; current state cached for AI ticks.|
|**P‑4**|**Multi‑Layer Approval** – Central, legislative, provincial, or supranational bodies may veto.|Clause metadata lists _ApproverRoles_; passes only if **all** reach _NetAccept ≥ 0_.|
|**P‑5**|**Secrecy = Leverage + Risk** – Hidden clauses grant bargaining power but can leak.|Leak chance grows via global _Transparency‑Norm_ and spy missions.|
|**P‑6**|**Espionage Has Three Phases** – draft leaks, leverage theft, compliance audit.|Four spy missions (see §2.7) live in Espionage panel.|
|**P‑7**|**Great‑Power Guarantees Can Deter Fully** – A super‑power backer may render a micro‑state untouchable.|Soft ln() curve (see §2.5) with tunable ceiling parameter.|
|**P‑8**|**Mod‑First** – No magic values locked in code.|Weights, token IDs, curves all reside in plaintext tuning files.|

---

## 2 Core Mechanics

### 2.1 Credibility Formula

```
BaseCred       = 0.60 × MilitaryPower + 0.30 × DyadicTrust
GuaranteeBoost = 25 × ln(1 + Cred_guarantor / Cred_signer)
CredTotal      = BaseCred + Σ(G Boost per guarantor)
```

_The 25 constant lives in_ `_diplomacy_tuning.json_`_._

### 2.2 Trust & Audience Cost

- **Trust (−100…+100)**: +1/turn for perfect compliance; big negative on _BreachDeclared_.
    
- **Audience‑Meter**: composite of Prosperity, MediaFreedom, Propaganda.
    

```
UnrestΔ = BreachSeverity × AudienceMeter × WarFatigue
```

### 2.3 Clause Structure & Legislative Process

```
Clause
  id: clause.truce
  behaviour: Game.Treaties.Clauses.Truce
  category: Political
  term: 24      # turns
  renewal: Auto
  visibility: Public | Secret
  baseAccept: 30
  approvers:
    - role: HeadOfState
      alignTag: any
    - role: LowerHouse
      alignTag: pacifist   # alignment bonus if legislature == pacifist
    - role: ProvincialDiet
      scope: affectedProvinces
```

_Alignment bonus_ **(+X; FN‑A)** is granted when `alignTag` matches the chamber’s ideology.

#### NetAccept Calculation

```
NetAccept = BaseAccept – PoliticalCost + AlignmentBonus
            + Σ Money( +10 scaling 25 %)
            + Σ Favours( +15 )
            + CulturalRelBonus( +X )
            + TechPrestige( +5…10 )
            + CoercionTokens( +25 & unrest )
```

Passes if **≥ 0**.

### 2.4 Acceptability Tokens

|   |   |   |   |
|---|---|---|---|
|Token|Gained From|Spend Effect|Decay|
|Money|Treasury|+10 / tranche|spent|
|Favour|Ally support, trade concessions|+15; one‑shot|consumed|
|Cultural / Religious Authority|Festivals, holy sites|+(authority/10)|−1 / turn|
|Tech Prestige|First‑to‑invent, open patents|+(gap/2)|−1 / turn|
|Coercion|Spy _Apply Pressure_|+25, +UnrestΔ|consumed|

### 2.5 Guarantees & Spheres of Influence

_Boost per guarantor_ = `25 × ln(1 + Cred_g / Cred_s)` (tunable constant 25).

- Multiple super‑power guarantees stack with diminishing returns.
    
- If CredTotal crosses the AI’s _DeterrenceThreshold_ the target is deemed “functionally immune.”
    

### 2.6 Secrecy & Transparency Norm

|   |   |   |
|---|---|---|
|Level|Trigger|LeakChance Δ|
|0|Default|+0 %|
|1|First polity enacts _Publish‑All‑Treaties_|+5 %|
|2…N|Each additional major‑power adopter|+5 %/level (FN‑E)|

### 2.7 Espionage Missions (All ordered from Espionage → Diplomacy Ops)

|   |   |   |   |
|---|---|---|---|
|Mission|Phase|Base Difficulty|Outcome|
|Intercept Draft|Negotiation|30|Reveal clause list; +1 Favour token owed by drafter.|
|Plant Leak|Pre‑signature|45|Doubles next‑turn leak chance for secret clauses.|
|Apply Pressure|Ratification|50|+1 Coercion token; +UnrestΔ (default 5×AudienceMeter, FN‑C).|
|Audit Compliance|Post‑sign|recurring 40|Annual clause check; breach fires on fail.|
|_Exact success equations in_ **_FN‑B_**_._|

### 2.8 Multilateral Charters & Voting Rules

```
Charter
  voteWeight: EconomicShare | DiplomaticPower | Equal | CustomRef
  passThreshold:
    type: QualifiedMajority
    value: 67        # percent
  sessionTurns: 12
  allowsSecretRes: false
```

_Amending a charter writes_ `_CharterUpdated_` _events; clauses inside use the same NetAccept path._

### 2.9 Player Workflow & UI (functions, not visuals)

1. **Propose Treaty** → Quick pop‑up if 1 clause, full _Negotiation Table_ if 2+.
    
2. **Negotiation Table** – realtime NetAccept bars per side, add/remove clauses.
    
3. **Send Draft** – triggers espionage window pop in case of leaks.
    
4. **Ratification Tracker** – shows each approver role, NetAccept, and tokens still needed.
    
5. **Active Treaty Tooltip** – urgency icons for nearing expiry, breached, or leaked.
    

---

## 3 Data & Mod Support

### 3.1 Clause JSON Example (customs‑union)

```
{
  "id": "clause.customs_union",
  "behaviour": "Game.Treaties.Clauses.CustomsUnion",
  "category": "Trade",
  "term": 60,
  "renewal": "Auto",
  "visibility": "Public",
  "baseAccept": 40,
  "approvers": [
    { "role": "HeadOfState", "alignTag": "any" },
    { "role": "LowerHouse", "alignTag": "protectionist" }
  ]
}
```

Missing behaviour class ⇒ clause skipped with log warning.

### 3.2 Tuning File Snippet (`diplomacy_tuning.json`)

```
{
  "credibilityWeights": { "military": 0.60, "trust": 0.30 },
  "guaranteeConstant": 25,
  "bribeScaling": 1.25,
  "tokenValues": {
    "money": 10,
    "favour": 15,
    "coercion": 25
  }
}
```

---

## 4 System & Event Types

|   |   |   |
|---|---|---|
|System|Responsibility|Key Structs|
|**TreatySystem**|Create/update treaty streams; expose cache for AI.|`Treaty`, `TreatyEvent`, `ClauseState`|
|**LegislatureSystem**|Compute NetAccept; apply tokens & alignment.|`Chamber`, `AcceptabilityLedger`|
|**TrustSystem**|Maintain dyadic Trust matrix; recalc Credibility.|`TrustMatrix`, `CredCache`|
|**EspionageSystem**|Execute missions, write `SecretExposed`, `BreachDeclared`.|`SpyNetwork`, `MissionTemplate`|

Event taxonomy (all append‑only): `TreatySigned`, `ClauseAdded`, `RatifiedBy`, `SecretExposed`, `CharterUpdated`, `BreachDeclared`, `ClauseVoided`.

---

## 5 Footnotes / Deferred Tuning Items

|   |   |   |
|---|---|---|
|ID|Subject|To Decide Later|
|**FN‑A**|Alignment bonus magnitude|calibrate in play‑tests|
|**FN‑B**|Spy success curve|linear vs diminishing returns|
|**FN‑C**|Coercion unrest multiplier|default 5 × AudienceMeter|
|**FN‑D**|Release‑day clause library|final list pending further brainstorm|
|**FN‑E**|Leak‑chance bonus per transparency level|quantify|

_End of Concept v1.1 – ready for code scaffolding._